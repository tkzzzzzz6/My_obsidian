
# Experiments

## Datasets
We evaluate on three publicly available datasets spanning real tissues and a controlled simulation. Human Lymph Node (HLN).The HLN dataset [22] provides paired RNA, ADT, and spatial coordinates for 3,484 spots with expert cell-type annotations. Mouse Brain (MB). The MB dataset [28] integrates ATAC–RNA and CUT&Tag–RNA profiles from postnatal day 22 mouse brain, totaling 9,196 spatial spots. In the absence of ground-truth labels, we assess performance via cross-modal clustering consistency between RNA and ATAC. Simulation (Sim). The synthetic benchmark [22] contains simulated RNA, ATAC, and ADT modalities with 1,296 spatially annotated spots, enabling controlled evaluation of multi-modal integration under known ground truth.
我们在三个公开可用的数据集上进行了评估，这些数据集涵盖了真实组织和受控模拟。人类淋巴结（HLN）：HLN数据集[22]提供了3484个斑点的配对RNA、ADT和空间坐标，以及专家标注的细胞类型。小鼠大脑（MB）：MB数据集[28]整合了出生后22天小鼠大脑的ATAC-RNA和CUT&Tag-RNA图谱，总共有9196个空间斑点。在没有真实标签的情况下，我们通过RNA和ATAC之间的跨模态聚类一致性来评估性能。模拟（Sim）：合成基准[22]包含具有1296个空间注释斑点的模拟RNA、ATAC和ADT模态，能够在已知真实情况的条件下对多模态整合进行受控评估。
## Baseline Methods and Setup
We compare our method with several representative methods, including MOFA+[15], CiteFuse[18], SpatialGlue[22], STAGATE[20],and PRAGA[23].All experiments are conducted on an NVIDIA 3090 GPU using SGD with full-batch training, where the learning rate is set to 0.01 for dual-modality and 0.001 for tri-modality. For fair comparison,hyperparameters of the baselines follow the default configurations reported in their original papers.
我们将我们的方法与几种具有代表性的方法进行了比较，包括MOFA+[15]、CiteFuse[18]、SpatialGlue[22]、STAGATE[20]和PRAGA[23]。所有实验均在NVIDIA 3090 GPU上进行，采用随机梯度下降（SGD）进行全批量训练，其中双模态的学习率设为0.01，三模态的学习率设为0.001。为了进行公平比较，基线方法的超参数遵循其原始论文中报告的默认配置。
## Performance Analysis
We report averaged metrics: Info-Avg = (MI, NMI, AMI)/3, Clust-Avg = (FMI, ARI, V-Measure)/3, and Class-Avg = (F1, Jaccard,Completeness)/3, with the overall score defined as Overall-Avg =(Info-Avg + Clust-Avg + Class-Avg)/3. All metrics are referenced prior work [23]. As shown in Table 1, our method yields consistent improvements across all datasets, with the largest gain on MB (+6.40 Overall-Avg), and stable gains on HLN (+0.23) and Simulation (+0.52).
我们报告了平均指标：信息平均值（Info-Avg）=（互信息（MI）、标准化互信息（NMI）、调整后的互信息（AMI））/3，聚类平均值（Clust-Avg）=（Fowlkes-Mallows指数（FMI）、调整后的兰德指数（ARI）、V测度（V-Measure））/3，以及分类平均值（Class-Avg）=（F1分数、杰卡德指数、完整性）/3，整体得分定义为整体平均值（Overall-Avg）=（信息平均值+聚类平均值+分类平均值）/3。所有指标均参考了先前的研究[23]。如表1所示，我们的方法在所有数据集上都取得了一致的改进，其中在MB数据集上的增益最大（整体平均值提高6.40），在HLN数据集（提高0.23）和模拟数据集（提高0.52）上也有稳定的增益。
### Ablation Study
We conduct an ablation study on the MB dataset to evaluate the contributions of different components in our LRSMT framework (Table~\ref{tab:ablation}). The examined modules include RPR (row-propagation encoder), Align (cross-graph alignment), MS-APPNP (multi-scale diffusion), and Sched-$\beta$ (scheduled gating). For fairness, the baseline adopts identical preprocessing and evaluation settings as the full model. While enabling a single component yields noticeable improvements over the baseline, the gains remain limited. In contrast, combining all modules delivers the best overall performance, confirming that global diffusion, cross-modal alignment, and scheduled gating complement each other in enhancing structure-preserving and boundary-sensitive metrics.
我们在MB数据集上进行了消融研究，以评估我们的LRSMT框架中不同组件的作用（表\ref{tab:ablation}）。所考察的模块包括RPR（行传播编码器）、Align（跨图对齐）、MS-APPNP（多尺度扩散）和Sched- β（调度门控）。为保证公平性，基线采用与完整模型相同的预处理和评估设置。虽然启用单个组件比基线有明显改进，但增益仍然有限。相比之下，组合所有模块能获得最佳的整体性能，这证实了全局扩散、跨模态对齐和调度门控在提升结构保留和边界敏感指标方面是相辅相成的。

### Parameter Analysis
Additionally, we further investigated the impact of several hyperparameter choices on the HLN dataset. 
% alpha1 - Multi-scale Diffusion Parameter 1
% 控制第一个尺度（K=2）的扩散强度
% alpha2 - Multi-scale Diffusion Parameter 2
% 控制第二个尺度（K=4）的扩散强度
% beta0 - Scheduled Gate Initial Value
% 控制全局/局部信息平衡的初始权重

# Conclusion
\section{Conclusion}
% 简洁总结，不分小节
- 主要贡献总结（2-3句话）
- 实验结果亮点（1-2句话）
- 未来工作展望（1-2句话）




我们在三个空间多组学数据集上进行了评估：HLN、MouseBrain和Simulation。所有实验均在NVIDIA 3090 GPU上运行，使用随机梯度下降（SGD）进行全批量训练；我们将学习率设置为0.01（双模态）和0.001（三模态），轮次分别为30（10x）、200（SPOTS）、300（Stereo-CITE-seq/空间表观基因组-转录组）和200（Simulation）。我们采用多尺度扩散，其中（K，α）= {(2, 0.2), (4, 0.15), (8, 0.10)}，嵌入维度为64/128（双模态/三模态）；聚类通过mclust执行。为了公平比较，所有基线模型都采用相同的预处理流程和评估协议。


我们在三个公开可用的基准数据集上评估了我们的方法，这些数据集涵盖了真实和合成的空间多模态场景，包括HLN、MB、模拟 Stereo-CITE-seq 和 SPOTS 数据集。人类淋巴结数据集（HLN）[14] 是一个源自人类淋巴结切片的空间转录组分析数据集，包含 3484 个斑点的 RNA 测序数据、抗体衍生标签（ADT）数据、空间坐标和人工注释。小鼠大脑数据集（MB）[22] 是一个空间表观基因组转录组小鼠大脑数据集，采集自幼年小鼠大脑切片（P22），包含配对的 ATAC-RNA 数据集和三个空间 CUT & Tag-RNA 数据集；经过 SpatialGlue 预处理后，使用了 MB 数据集中的 9196 个斑点。由于没有标签，因此使用 RNA/ATAC 聚类一致性进行验证。模拟数据集 [14] 是一个空间多模态组学模拟数据集，具有 ADT-seq、ATAC-seq 和 RNA-seq 模态以及空间坐标，包含 1296 个斑点的三种模态和明确标签，用于在已知真实情况下来严格测试模型行为。小鼠胸腺（Stereo-CITE-seq）[13] 是一个空间转录组分析数据集。这是小鼠胸腺的一个多模态切片，提供了 4697 个斑点的 RNA、ADT 以及空间坐标信息。SPOTS 小鼠脾脏（SPOTS）[3] 源自同时对小鼠脾脏组织样本进行测序的结果，包含转录组、蛋白质组测序数据，并保留了 2568 个斑点。更多数据集分析可参见附录 B。


4.1 实验设置 
数据集。
我们使用五个公开可用的数据集来评估我们的方法，这些数据集代表了空间多模态组学分析的各种场景，既包括真实的生物样本，也包括合成的基准数据。人类淋巴结（HLN）数据集（Long等人，2024年）包含从人类淋巴结切片中获得的空间分辨转录组数据。该数据集包括RNA测序谱、抗体衍生标签（ADT）、空间定位数据以及涵盖3484个不同位点的专家整理注释。小鼠大脑（MB）数据集（Zhang等人，2023年）代表了从出生后第22天（P22）的幼年小鼠脑组织中收集的空间表观基因组和转录组信息。它整合了一个空间ATAC-RNA数据集以及三个单独的空间CUT & Tag-RNA数据集，经SpatialGlue后处理后总共有9196个测序位点。由于缺乏明确的注释，RNA和ATAC模态之间的聚类一致性被用作验证指标。合成空间多模态组学数据集（Long等人，2024年）是一个人工构建的基准，由ADT测序、ATAC测序和RNA测序模态的模拟数据组成。该数据集明确提供了1296个模拟位点的空间坐标和真实注释，能够在受控条件下对模型进行严格的验证和性能评估。

我们将我们的方法与以下完全测试时自适应方法进行了比较：Source、NORM [15]、DUA [9]、TENT [10]、EATA [27]。

在CIFAR-10-C和CIFAR-100-C上，我们使用的批处理大小为200，学习率为0.001；在ImageNet-C上，批处理大小为64，学习率为0.00025。所有实验均使用Adam优化器，权重衰减为零。为确保可比性，其他模型的超参数遵循其各自论文中的默认设置。对于我们的VBSA模型，在CIFAR-10-C和CIFAR-100-C上，α1为0.1，α2为0.0004，β0为0.5。在ImageNet-C上，α1为0.1，α2为0.0006，β0为1。


我们将我们的方法与\textbf{MOFA+}\cite{Argelaguet2020mofa+}、\textbf{CiteFuse}\cite{kim2020citefuse}、\textbf{STAGATE}\cite{Dong2022stagate}、\textbf{SpatialGlue}\cite{Long2024SpatialGlue} 和 \textbf{PRAGA}\cite{huang2024pragaprototypeawaregraphadaptive} 进行对比.

所有实验在 NVIDIA 3090 GPU 上运行，使用 SGD 进行全批量训练；我们将学习率设置为 0.01（双模态）和 0.001（三模态）,聚类由 mclust 完成。为确保可比性，其他模型的超参数遵循其各自论文中的默认设置,对于我们的模型,采用多尺度扩散 $(K,\alpha)={(2,0.2),(4,0.15),(8,0.10)}$，嵌入维度为 64/128（双/三模态）.
% SGD (momentum 0.9, weight decay $5\mathrm{e}{-}3/5\mathrm{e}{-}2$)

我们使用三组平均指标：\emph{Info-Avg} = (MI, NMI, AMI)/3，\emph{Clust-Avg} = (FMI, ARI, V-Measure)/3，\emph{Class-Avg} = (F1, Jaccard, Completeness)/3；总体分数定义为 \emph{Overall-Avg} = (Info-Avg + Clust-Avg + Class-Avg)/3。如表~\ref{tab:all_avg} 所示，我们的模型在各个数据集上均取得了一致的提升——其中在 \textbf{Mouse Brain} 上的提升最大（Overall-Avg 相比最佳基线 +6.40），而 \textbf{HLN} 和 \textbf{Simulation} 也表现出稳定增益（分别为 +0.23 和 +0.52），验证了我们的全局–局部融合与多尺度扩散在结构保持和边界敏感性指标上的联合优势。
我们的论文:
## Datasets
We evaluate our method on five publicly available datasets spanning both real biological samples and synthetic benchmarks. The Human Lymph Node (HLN) dataset[22] comprises RNA, ADT, and spatial coordinates with 3,484 expert-annotated spots. The Mouse Brain (MB) dataset [28] integrates ATAC-RNA and CUTTag-RNA pro-files from postnatal day 22 mouse brain, totaling 9,196 spatial spots,where clustering consistency between RNA and ATAC is used for validation due to the lack of ground-truth labels. The simulation dataset[22] contains simulated RNA, ATAC, and ADT modalities with 1,296 spatially annotated spots, enabling rigorous evaluation under controlled conditions.

我们在五个公开可用的数据集上对我们的方法进行了评估，这些数据集涵盖了真实的生物样本和合成基准。人类淋巴结（HLN）数据集[22]包含RNA、ADT和空间坐标，以及3484个由专家注释的位点。小鼠脑（MB）数据集[28]整合了来自出生后22天小鼠脑的ATAC-RNA和CUTTag-RNA图谱，共9196个空间位点，由于缺乏真实标签，RNA和ATAC之间的聚类一致性被用于验证。模拟数据集[22]包含模拟的RNA、ATAC和ADT模态，以及1296个带空间注释的位点，能够在受控条件下进行严格评估。

## Performance Analysis

We report averaged metrics:  
* *Info-Avg* = (MI, NMI, AMI)/3  
* *Clust-Avg* = (FMI, ARI, V-Measure)/3  
* *Class-Avg* = (F1, Jaccard, Completeness)/3  

The overall score is defined as:  
*Overall-Avg* = (Info-Avg + Clust-Avg + Class-Avg)/3.  

As shown in **Table 1**, our method yields consistent improvements across all datasets, with the largest gain on **MB** (+6.40 Overall-Avg), and stable gains on **HLN** (+0.23) and **Simulation** (+0.52).

我们报告了平均指标：* 信息平均值（Info-Avg）=（互信息（MI）、归一化互信息（NMI）、调整互信息（AMI））/3 * 聚类平均值（Clust-Avg）=（Fowlkes-Mallows指数（FMI）、调整兰德指数（ARI）、V度量（V-Measure））/3 * 分类平均值（Class-Avg）=（F1分数（F1）、杰卡德指数（Jaccard）、完整性（Completeness））/3
总体得分定义为：总体平均值（Overall-Avg）=（信息平均值 + 聚类平均值 + 分类平均值）/3。
如表1所示，我们的方法在所有数据集上都取得了一致的改进，其中在MB数据集上的增益最大（总体平均值提升6.40），在HLN数据集（提升0.23）和模拟数据集（提升0.52）上也有稳定的增益。

---

### Ablation Study

We conduct an ablation study on the **MB** dataset to evaluate the contributions of different components in our **LRSMT** framework (**Table 2**).  
The examined modules include:  

- **RPR**: row-propagation encoder  
- **Align**: cross-graph alignment  
- **MS-APPNP**: multi-scale diffusion  
- **Sched-β**: scheduled gating  

For fairness, the baseline adopts identical preprocessing and evaluation settings as the full model.  
- Enabling a single component yields noticeable improvements over the baseline, but the gains remain limited.  
- Combining all modules delivers the best overall performance, confirming that **global diffusion, cross-modal alignment, and scheduled gating** complement each other in enhancing structure-preserving and boundary-sensitive metrics.
我们在MB数据集上进行了消融研究，以评估我们的LRSMT框架中不同组件的作用（表2）。所考察的模块包括：
- RPR：行传播编码器
- Align：跨图对齐
- MS-APPNP：多尺度扩散
- Sched-β：调度门控

为保证公平性，基线采用与完整模型相同的预处理和评估设置。
- 启用单个组件比基线有明显改进，但增益仍然有限。
- 组合所有模块可获得最佳的整体性能，这证实了全局扩散、跨模态对齐和调度门控在提升结构保持和边界敏感指标方面是相辅相成的。

#### Table 2. Ablation on MB
(✔ enabled, ✘ disabled)

| model         | RPR | Align | MS-APPNP | Sched-β | Avg.  |
|---------------|-----|-------|----------|---------|-------|
| Baseline      | ✘   | ✘     | ✘        | ✘       | 44.11 |
|               | ✔   | ✘     | ✘        | ✘       | 45.46 |
|               | ✘   | ✔     | ✘        | ✘       | 49.94 |
|               | ✘   | ✘     | ✔        | ✘       | 48.92 |
|               | ✘   | ✘     | ✘        | ✔       | 48.70 |
| **LRSMT (Ours)** | ✔   | ✔     | ✔        | ✔       | **50.51** |

---

### Parameter Analysis

Additionally, we further investigated the impact of several hyperparameter choices on the **HLN** dataset.  
As illustrated in **Figure 1**, the method consistently achieves strong results within a stable parameter range, demonstrating its robustness and adaptability across diverse settings.
此外，我们进一步研究了几个超参数选择对HLN数据集的影响。如图1所示，该方法在稳定的参数范围内始终能取得良好的结果，这表明其在不同设置下具有稳健性和适应性。

#### Figure 1. Parameter analysis on HLN
- Left/Center/Right: Overall-Avg vs. α₁, α₂, and β₀  
- Moderate diffusion (α ≈ 0.10–0.20) and mid-range β₀ (≈ 1.7–2.3) yield the best performance, while extremes degrade.
左/中/右：总体平均值与α₁、α₂和β₀的对比——适度扩散（α≈0.10–0.20）和中等范围的β₀（≈1.7–2.3）产生最佳性能，而极端值会降低性能。

![[Pasted image 20250911202811.png]]

# Conclusion


空间分辨多组学为解析组织微环境中的细胞状态转变与空间互作提供了系统化的新途径,我们提出了一个新的空间多组学整合的稳健框架LRSMT，该方法将跨图对齐与时间调度扩散相结合，以平衡局部边界细化和全局拓扑保留。具体而言，RPR编码器稳定早期优化并保护清晰边界，跨图对齐在不同模态间传递互补线索，多尺度APPNP保留全局聚类几何结构，而调度门则逐渐重新调整全局与局部信息的权重。在三个数据集（HLN、MB和模拟数据集）上，LRSMT在信息导向、聚类导向和分类导向的指标上均优于竞争性基线方法,为空间分辨多组学建立了新的基准.

全测试时自适应（FTTA）为领域自适应提供了一条很有前景的途径，但传统技术存在其局限性。在本文中，我们提出了一种新颖的FTTA方法，该方法利用奇异值和方差平衡来增强模型多样性。通过整合语义增强，我们有效地缓解了FTTA中样本不平衡的问题。VBSA在保留不同类别知识方面的熟练能力，以及它在基准数据集上的优异表现，为FTTA领域建立了新的基准。

空间分辨多组学为解析组织微环境中的细胞状态转变与空间互作提供了新途径。我们提出稳健的整合框架 **LRSMT**，通过跨图对齐与时间调度扩散协同平衡全局拓扑保持与局部边界细化。具体而言，RPR 编码器稳定早期优化并保留清晰边界，跨图对齐在模态间传递互补信息，多尺度 APPNP 捕捉全局聚类几何结构，而调度门逐步调控全局与局部特征的权重。在 HLN、MB 和模拟数据集上，LRSMT 在信息、聚类与分类三类指标上均超越竞争基线，为解析复杂组织微环境提供了新的有力工具
